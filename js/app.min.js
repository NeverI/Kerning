function Sidebar(e,t,n){var r=this;this.view=e,this.inputparams=t,this.view.on("change","input,select",function(e){r.changed($(e.target))}),this.view.on("spin",function(e,t){r.changed($(e.target),t.value)}),this.init(n)}function InputParams(e){this.name=e.name,this.type=e.type?e.type:InputParams.CSS,this.inputType=e.inpuType?e.inpuType:InputParams.INPUT,this.callback=e.callback,this.on=e.on,this.valueTransfrom=e.valueTransfrom}(function(e){var t=function(){var t={},n,r=65,i,s='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},u=function(t,n){var r=q(t);e(n).data("colorpicker").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,n){e(n).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},f=function(t,n){e(n).data("colorpicker").fields.eq(0).val(U(t)).end()},l=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor","#"+U({h:t.h,s:100,b:100})),e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},h=function(t,n){e(n).data("colorpicker").currentColor.css("backgroundColor","#"+U(t))},p=function(t,n){e(n).data("colorpicker").newColor.css("backgroundColor","#"+U(t))},d=function(t){var n=t.charCode||t.keyCode||-1;if(n>r&&n<=90||n==32)return!1;var i=e(this).parent().parent();i.data("colorpicker").livePreview===!0&&v.apply(this)},v=function(t){var n=e(this).parent().parent(),r;this.parentNode.className.indexOf("_hex")>0?n.data("colorpicker").color=r=F(B(this.value)):this.parentNode.className.indexOf("_hsb")>0?n.data("colorpicker").color=r=P({h:parseInt(n.data("colorpicker").fields.eq(4).val(),10),s:parseInt(n.data("colorpicker").fields.eq(5).val(),10),b:parseInt(n.data("colorpicker").fields.eq(6).val(),10)}):n.data("colorpicker").color=r=I(H({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10)})),t&&(u(r,n.get(0)),f(r,n.get(0)),a(r,n.get(0))),l(r,n.get(0)),c(r,n.get(0)),p(r,n.get(0)),n.data("colorpicker").onChange.apply(n,[r,U(r),q(r)])},m=function(t){var n=e(this).parent().parent();n.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},g=function(){r=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")},y=function(t){var n=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",r,w),e(document).bind("mousemove",r,b)},b=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&v.apply(e.data.field.get(0),[!0]),!1},w=function(t){return v.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",w),e(document).unbind("mousemove",b),!1},E=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,x),e(document).bind("mousemove",n,S)},S=function(e){return v.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},x=function(t){return u(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),f(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",x),e(document).unbind("mousemove",S),!1},T=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,C),e(document).bind("mousemove",n,N)},N=function(e){return v.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},C=function(t){return u(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),f(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",C),e(document).unbind("mousemove",N),!1},k=function(t){e(this).addClass("colorpicker_focus")},L=function(t){e(this).removeClass("colorpicker_focus")},A=function(t){var n=e(this).parent(),r=n.data("colorpicker").color;n.data("colorpicker").origColor=r,h(r,n.get(0)),n.data("colorpicker").onSubmit(r,U(r),q(r),n.data("colorpicker").el)},O=function(t){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset(),i=D(),s=r.top+this.offsetHeight,o=r.left;return s+176>i.t+i.h&&(s-=this.offsetHeight+176),o+356>i.l+i.w&&(o-=356),n.css({left:o+"px",top:s+"px"}),n.data("colorpicker").onShow.apply(this,[n.get(0)])!=0&&n.show(),e(document).bind("mousedown",{cal:n},M),!1},M=function(t){_(t.data.cal.get(0),t.target,t.data.cal.get(0))||(t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide(),e(document).unbind("mousedown",M))},_=function(e,t,n){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);var r=t.parentNode;while(r&&r!=n){if(r==e)return!0;r=r.parentNode}return!1},D=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},P=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},H=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},B=function(e){var t=6-e.length;if(t>0){var n=[];for(var r=0;r<t;r++)n.push("0");n.push(e),e=n.join("")}return e},j=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},F=function(e){return I(j(e))},I=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.b=r,r!=0,t.s=r!=0?255*i/r:0,t.s!=0?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},q=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0),n<60?(t.r=s,t.b=o,t.g=o+u):n<120?(t.g=s,t.b=o,t.r=s-u):n<180?(t.g=s,t.r=o,t.b=o+u):n<240?(t.b=s,t.r=o,t.g=s-u):n<300?(t.b=s,t.g=o,t.r=o+u):n<360?(t.r=s,t.g=o,t.b=s-u):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},R=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)}),n.join("")},U=function(e){return R(q(e))},z=function(){var t=e(this).parent(),n=t.data("colorpicker").origColor;t.data("colorpicker").color=n,u(n,t.get(0)),f(n,t.get(0)),a(n,t.get(0)),l(n,t.get(0)),c(n,t.get(0)),p(n,t.get(0))};return{init:function(t){t=e.extend({},o,t||{});if(typeof t.color=="string")t.color=F(t.color);else if(t.color.r!=undefined&&t.color.g!=undefined&&t.color.b!=undefined)t.color=I(t.color);else{if(t.color.h==undefined||t.color.s==undefined||t.color.b==undefined)return this;t.color=P(t.color)}return this.each(function(){if(!e(this).data("colorpickerId")){var n=e.extend({},t);n.origColor=t.color;var r="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colorpickerId",r);var i=e(s).attr("id",r);n.flat?i.appendTo(this).show():i.appendTo(document.body),n.fields=i.find("input").bind("keyup",d).bind("change",v).bind("blur",m).bind("focus",g),i.find("span").bind("mousedown",y).end().find(">div.colorpicker_current_color").bind("click",z),n.selector=i.find("div.colorpicker_color").bind("mousedown",T),n.selectorIndic=n.selector.find("div div"),n.el=this,n.hue=i.find("div.colorpicker_hue div"),i.find("div.colorpicker_hue").bind("mousedown",E),n.newColor=i.find("div.colorpicker_new_color"),n.currentColor=i.find("div.colorpicker_current_color"),i.data("colorpicker",n),i.find("div.colorpicker_submit").bind("mouseenter",k).bind("mouseleave",L).bind("click",A),u(n.color,i.get(0)),a(n.color,i.get(0)),f(n.color,i.get(0)),c(n.color,i.get(0)),l(n.color,i.get(0)),h(n.color,i.get(0)),p(n.color,i.get(0)),n.flat?i.css({position:"relative",display:"block"}):e(this).bind(n.eventName,O)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&O.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if(typeof t=="string")t=F(t);else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined)t=I(t);else{if(t.h==undefined||t.s==undefined||t.b==undefined)return this;t=P(t)}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t,n.data("colorpicker").origColor=t,u(t,n.get(0)),a(t,n.get(0)),f(t,n.get(0)),c(t,n.get(0)),l(t,n.get(0)),h(t,n.get(0)),p(t,n.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor})})(jQuery);var KerningField=function(){function e(e,n){this.view=e,this.smartView=undefined,this.baseLetterSpacing=0,this.letters=new t(this),this.action="",this.selectedColor="",this.canVertical=n,this.frameworkInit(),this.setLetterSpacing(),this.setText(this.view.innerHTML)}function t(e){this.parent=e,this.data=[new n("")],this.cursor=0,this.exp={chars:/>(.+)</,letterSpacing:/lp_(.+)/,verticalSpacing:/vp_(.+)/}}function n(e){this.view=undefined,this.value="",this.letterSpacing=0,this.verticalSpacing=0,this.isBrake=!1,this.set(e)}function r(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]}function i(e,t,n){var r=n|t<<8|e<<16;return"#"+r.toString(16)}function s(e){return e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/)}function o(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=(r+i)/2;if(r==i)s=o=0;else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s,o,u]}function u(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function a(e,t,n){var r,i,s;if(t==0)r=i=s=n;else{var o=n<.5?n*(1+t):n+t-n*t,a=2*n-o;r=u(a,o,e+1/3),i=u(a,o,e),s=u(a,o,e-1/3)}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]}return Action={RESTORE:"RESTORE"},e.prototype.frameworkInit=function(){var e=this;this.smartView=$(this.view),this.smartView.on("dblclick",this.enableEditable()),this.smartView.on("blur",this.disableEditable()),this.smartView.on("keyup",this.editKeyEventHandler()),this.smartView.on("keydown","span",this.controlKeyEventHandler()),this.smartView.on("focusin","span",function(t){e.smartView.find("span").css("color",""),$(t.target).css("color",e.selectedColor)}),this.smartView.on("focusout","span",function(t){e.smartView.find("span").css("color","")})},e.prototype.triggerChange=function(){this.smartView.trigger("change")},e.prototype.focus=function(){this.smartView.focus()},e.prototype.blur=function(){this.smartView.blur()},e.prototype.setLetterSpacing=function(e){this.baseLetterSpacing=e!==undefined?e:parseInt(this.view.style.letterSpacing),this.baseLetterSpacing=this.baseLetterSpacing?this.baseLetterSpacing:0,this.letters.refresh()},e.prototype.setColor=function(e){var t,n,i=.1,u=.07;this.selectedColor=e!==undefined?e:this.view.style.color,this.selectedColor.indexOf("rgb")!=-1?(t=s(this.selectedColor),n=o(t[1],t[2],t[3])):(t=r(this.selectedColor),n=o(t[1],t[2],t[3])),n[0]+u>1?n[0]-=u:n[0]+=u,n[2]-i<0?n[2]+=i:n[2]-=i,t=a(n[0],n[1],n[2]),this.selectedColor="#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)},e.prototype.setText=function(e){var t,n,r,i,s,o;e=e.replace(/$(<br>)+/,""),e=e.replace(/<div>/g,"<br>").replace(/<\/div>/g,""),e=e.replace(/<p>/g,"").replace(/<\/p>/g,""),e=e.replace(/&nbsp;/g,""),e.replace(/<br>/g,"")==""&&(e="Kerning"),this.letters.resetCursor(),s=this.splitByBR(e);for(r=0,i=s.length;r<i;r++){o=s[r];if(o.indexOf("<span")!==-1){o=o.split("/span>");for(t=0,n=o.length;t<n;t++)this.letters.set(o[t])}else this.letters.set(o);r!=i-1&&this.letters.set("<br>")}this.letters.appendLetters(this.view)},e.prototype.splitByBR=function(e){return e.indexOf("<br>")!==-1?e.split("<br>"):e.indexOf("<br/>")!==-1?e.split("<br/>"):e.indexOf("<br />")!==-1?e.split("<br />"):[e]},e.prototype.enableEditable=function(){var e=this;return e.enableEditable=function(t){e.view.setAttribute("contenteditable","true");while(e.view.firstChild)e.view.removeChild(e.view.firstChild);e.focus()},e.enableEditable},e.prototype.disableEditable=function(){var e=this;return e.disableEditable=function(t){e.view.setAttribute("contenteditable","false"),e.action!=Action.RESTORE?(e.setText(e.view.innerHTML.replace(/<div><br><\/div>/g,"")),e.triggerChange()):e.action=""},e.disableEditable},e.prototype.restoreLastState=function(){this.letters.appendLetters(this.view),this.action=Action.RESTORE,this.blur()},e.prototype.controlKeyEventHandler=function(){var e=this;return e.controlKeyEventHandler=function(t){var n=t.target.letterObject;if(!n)return;switch(t.keyCode){case 68:case 39:n.setLetterSpacing(n.letterSpacing+(t.shiftKey?10:1),e.baseLetterSpacing);break;case 65:case 37:n.setLetterSpacing(n.letterSpacing-(t.shiftKey?10:1),e.baseLetterSpacing);break;case 87:case 38:e.canVertical&&n.setVerticalSpacing(n.verticalSpacing-(t.shiftKey?10:1));break;case 85:case 83:e.canVertical&&n.setVerticalSpacing(n.verticalSpacing+(t.shiftKey?10:1))}e.triggerChange()},e.controlKeyEventHandler},e.prototype.editKeyEventHandler=function(){var e=this;return e.editKeyEventHandler=function(t){switch(t.keyCode){case 27:e.restoreLastState();break;case 13:t.shiftKey?(t.preventDefault(),e.letters.set("<br/>"),e.triggerChange()):e.blur()}},e.editKeyEventHandler},e.prototype.getDOMString=function(e){return'<div class="kerned">'+this.letters.getDOMString(e)+"\n</div>"},e.prototype.getCSSString=function(e){var t=".kerned {",n;return this.view.style.color.indexOf("rgb")!=-1?(n=s(this.view.style.color),t+="color: "+i(n[1],n[2],n[3])):t+="color: "+this.view.style.color,t+="; font-size: "+this.view.style.fontSize,this.view.style.fontStyle!="normal"&&(t+="; font-style: "+this.view.style.fontStyle),t+="; font-family: "+this.view.style.fontFamily,t+="; line-height: "+this.view.style.lineHeight,t+="; text-align: "+this.view.style.textAlign,this.view.style.fontWeight!="normal"&&(t+="; font-weight: "+this.view.style.fontWeight),t+="}\n\n",t+this.letters.getCSSString(e)},t.prototype.resetCursor=function(){this.cursor=0},t.prototype.setCursor=function(e){e!==undefined&&(this.cursor=e)},t.prototype.set=function(e,t){var n,r,i,s,o=0,u=0;if(e.indexOf("<span")===0){n=e.match(this.exp.chars);if(!n||!n[1])return;n=n[1],o=this.getParamFromClass("letterSpacing",e),u=this.getParamFromClass("verticalSpacing",e)}else e.indexOf("<br")===0?n=[e]:n=e;this.setCursor(t);for(i=0,s=n.length;i<s;i++)r=this.setInvidual(n[i]),r.setLetterSpacing(o,this.parent.baseLetterSpacing),r.setVerticalSpacing(u),this.cursor++;return r},t.prototype.setInvidual=function(e){return this.data[this.cursor]?this.data[this.cursor].set(e):this.data[this.cursor]=new n(e),this.data[this.cursor]},t.prototype.get=function(e){return this.data[e]},t.prototype.getParamFromClass=function(e,t){var n=t.match(this.exp[e]);return n&&n[1]?parseInt(n):0},t.prototype.getCSSString=function(e){var t="",n,r,i,s;if(e)for(i=0,s=this.cursor;i<s;i++)n=this.data[i].getLetterSpacing(this.parent.baseLetterSpacing),r=this.data[i].verticalSpacing,n!==0&&t.indexOf("ls_"+n+" ")==-1&&(t+=".ls_"+n+" { letter-spacing: "+n+"px;}\n"),r!==0&&t.indexOf("vs_"+r+" ")==-1&&(t+=".vs_"+r+" { top: "+r+"px;}\n");return t},t.prototype.getDOMString=function(e){var t="",n,r,i,s,o,u,a;if(!e)for(n=0,r=this.cursor;n<r;n++)i=this.data[n],i.isBrake?t+=i.value:t+='\n	<span style="letter-spacing:'+i.getLetterSpacing(this.parent.baseLetterSpacing)+"px;top:"+i.verticalSpacing+'px">'+i.value+"</span>";else{s=this.data[0].getLetterSpacing(this.parent.baseLetterSpacing),o=this.data[0].verticalSpacing;for(n=0,r=this.cursor;n<r;n++)i=this.data[n],i.isBrake?(t+="</span>",t+=i.value,u=!1,a=!0):i.getLetterSpacing(this.parent.baseLetterSpacing)==s&&i.verticalSpacing==o?(u||(t+="\n	<span"+this.getClasses(s,o)+">",u=!0,a=!1),t+=i.value):(a||(t+="</span>",a=!1),s=i.getLetterSpacing(this.parent.baseLetterSpacing),o=i.verticalSpacing,t+="\n	<span"+this.getClasses(s,o)+">"+i.value,u=!0);t+="</span>"}return t},t.prototype.getClasses=function(e,t){var n="";if(e||t)n+=' class="'+(e?"ls_"+e:""),n+=(e&&t?" ":"")+(t?"vs_"+t:""),n+='"';return n},t.prototype.appendLetters=function(e){var t,n;while(e.firstChild)e.removeChild(e.firstChild);for(t=0,n=this.cursor;t<n;t++)e.appendChild(this.data[t].view)},t.prototype.refresh=function(){var e;for(var t=0;t<this.cursor;t++)e=this.data[t],e.isBrake?this.data[t-1].setLetterSpacing(-this.parent.baseLetterSpacing,this.parent.baseLetterSpacing):e.setLetterSpacing(undefined,this.parent.baseLetterSpacing);e=this.data[this.cursor-1],e&&e.setLetterSpacing(-this.parent.baseLetterSpacing,this.parent.baseLetterSpacing)},n.prototype.set=function(e){e||(e="");if(e.indexOf("<br")==0){if(!this.view||this.view.nodeName.toLowerCase()!="br")this.view=document.createElement("br"),this.isBrake=!0}else{if(!this.view||this.isBrake)this.view=document.createElement("span"),this.view.setAttribute("tabindex","1"),this.view.letterObject=this,this.isBrake=!1;this.view.innerHTML=e}this.value=e},n.prototype.getLetterSpacing=function(e){return e+this.letterSpacing},n.prototype.setLetterSpacing=function(e,t){if(this.isBrake)return;e!==undefined&&(this.letterSpacing=e),this.view.style.letterSpacing=this.getLetterSpacing(t)+"px"},n.prototype.setVerticalSpacing=function(e){if(this.isBrake)return;e!==undefined&&(this.verticalSpacing=e),this.view.style.top=this.verticalSpacing+"px"},e}(),App={kerningField:undefined,leftbar:undefined,topbar:undefined,bottombar:undefined,init:function(e,t,n,r){var i=this;$("#Content").css("display","block").animate({opacity:1}),window.onresize=this.resize(e),this.alignKerningText(e),$("input[name=FontSize]").spinner({min:1}),$("input[name=LetterSpacing]").spinner(),$("input[name=LineHeight]").spinner(),this.kerningField=new KerningField(e[0],!0),e.on("change",this.alignKerningText),this.leftbar=new Sidebar(t,{FontFamily:new InputParams({on:e,name:"font-family",callback:this.alignKerningText}),FontSize:new InputParams({on:e,name:"font-size",callback:this.alignKerningText,valueTransfrom:function(e){return e+"px"}}),LetterSpacing:new InputParams({on:e,name:"letter-spacing",callback:function(e){i.kerningField.setLetterSpacing(),i.alignKerningText()},valueTransfrom:function(e){return e+"px"}}),LineHeight:new InputParams({on:e,name:"line-height",callback:this.alignKerningText,valueTransfrom:function(e){return e+"px"}}),TextAlign:new InputParams({on:e,name:"text-align",inputType:InputParams.SELECT,callback:function(){$("#CSSOutput").text(i.kerningField.getCSSString($("input[name=isOptimazed]").is(":checked")))}}),IsBold:new InputParams({on:e,name:"font-weight",callback:this.alignKerningText,valueTransfrom:function(e){return e?"bold":"normal"}}),IsItalic:new InputParams({on:e,name:"font-style",callback:this.alignKerningText,valueTransfrom:function(e){return e?"italic":"normal"}}),TextColor:new InputParams({on:e,name:"color",callback:function(){i.kerningField.setColor(),$("#CSSOutput").text(i.kerningField.getCSSString($("input[name=isOptimazed]").is(":checked")))},valueTransfrom:function(e){return"#"+e}}),BackgroundColor:new InputParams({on:$("body"),name:"background-color",valueTransfrom:function(e){return"#"+e}}),Background:new InputParams({on:$("body"),name:"background-image",valueTransfrom:function(e){return e?"url('images/gradient.png'),url('images/noise.png')":""}})},Sidebar.LEFT),this.topbar=new Sidebar(n,{},Sidebar.TOP),this.bottombar=new Sidebar(r,{isOptimazed:new InputParams({on:this,name:"changeCodeOutput",type:InputParams.FUNCTION})},Sidebar.BOTTOM),$("#MainSetup input[name=TextColor]").ColorPicker({onChange:this.triggerChangeInColorPicker("TextColor"),color:$("#MainSetup input[name=TextColor]").val()}),$("#MainSetup input[name=BackgroundColor]").ColorPicker({onChange:this.triggerChangeInColorPicker("BackgroundColor"),color:$("#MainSetup input[name=BackgroundColor]").val()}),this.leftbar.view.on("click",function(){window.onresize()}),this.bottombar.view.on("click",function(){window.onresize()}),window.onresize(),setTimeout(function(){if($("#MainInfo.closed")[0])return;$("#MainInfo .flap").trigger("click")},5e3)},alignKerningText:function(e){var t=this,n=$("input[name=isOptimazed]");this.alignKerningText=function(){e.css({"margin-left":~~(-e.width()*.5)+"px","margin-top":~~(-e.height()*.5)+"px"}),t.changeCodeOutput(n.is(":checked"))}},changeCodeOutput:function(e){$("#DOMOutput").text(this.kerningField.getDOMString(e)),$("#CSSOutput").text(this.kerningField.getCSSString(e))},triggerChangeInColorPicker:function(e){var t=$("#MainSetup input[name="+e+"]");return function(){t.val(this.find(".colorpicker_hex input").val()).trigger("change")}},browserIsSucks:function(){return $.browser.msie&&parseFloat($.browser.version)<9?($("#Content").html(""),!0):!1},resize:function(e){var t=this,n=$("#Outputs"),r=$("#MainSetup");return function(){var t=document.body.offsetWidth,i=document.body.offsetHeight,s=!n.hasClass("closed")&&i-n.height()<i*.5+e.height()*.5+40?(i-n.height())*.5-10+"px":"50%",o=!r.hasClass("closed")&&r.outerWidth()+40>t*.5-e.width()*.5?(t+r.outerWidth())*.5+"px":"50%";e.css("top",s),e.css("left",o!="50%"&&parseInt(o)+e.width()*.5<t?o:"50%")}}};Sidebar.LEFT="left",Sidebar.RIGHT="right",Sidebar.TOP="top",Sidebar.BOTTOM="bottom",Sidebar.prototype.init=function(e){this.view.find(">:first-child").prepend('<div class="flap">&gt;</div>');var t=this.view.find(".flap"),n,r;$.browser.mozilla?(n=3,r=5):(n=2,r=3),e==Sidebar.LEFT?t.css({top:~~(this.view.height()*.5-t.outerHeight()*.5)+"px",right:~~(-t.outerWidth()*.75)+"px"}):e==Sidebar.RIGHT?t.css({top:~~(this.view.height()*.5-t.outerHeight()*.5)+"px",left:~~(-t.outerWidth()*.75)+"px"}):e==Sidebar.TOP?t.css({top:~~(this.view.outerHeight()-t.outerHeight()*.25-n)+"px",left:~~(this.view.outerWidth()*.5-t.outerWidth()*.5)+"px"}):e==Sidebar.BOTTOM&&t.css({bottom:~~(this.view.outerHeight()-t.outerHeight()*.25-r)+"px",left:~~(this.view.outerWidth()*.5-t.outerWidth()*.5)+"px"}),t.on("click",this.flapClick());for(name in this.inputparams)this.view.find(this.inputparams[name].inputType+"[name="+name+"]").trigger("change")},Sidebar.prototype.changed=function(e,t){var n=this.inputparams[e.attr("name")];if(!n)return;t===undefined&&(e.attr("type")=="checkbox"?t=e.is(":checked"):t=e.attr("value")),t=n.convert(t),n.type==InputParams.CSS?n.on.css(n.name,t):n.type==InputParams.PARAM?n.on[n.name]=t:n.type==InputParams.FUNCTION&&n.on[n.name](t),n.callback&&n.callback()},Sidebar.prototype.flapClick=function(){var e=this;return function(){e.view.toggleClass("closed"),e.view.find(".flap").text(e.view.hasClass("closed")?"<":">")}},InputParams.INPUT="input",InputParams.SELECT="select",InputParams.CSS="css",InputParams.PARAM="param",InputParams.FUNCTION="func",InputParams.prototype.convert=function(e){return this.valueTransfrom?this.valueTransfrom(e):e},$(document).ready(function(){if(App.browserIsSucks())return;App.init($("#Text"),$("#MainSetup"),$("#MainInfo"),$("#Outputs"))});